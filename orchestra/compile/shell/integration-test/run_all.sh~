#!/bin/sh

export NQI_VERSION=head
export NQI_REP=/usr/local/nqi/dev/${NQI_VERSION}/nqi

./generate-script.sh
./create-platform-database.sh
./create-orchestra-database.sh

cd $NQI_REP/platform/platform-ejb-test
mvn clean install
STATUS=$?
if ! [ $STATUS -eq 0 ]; then
	echo "Platform clean install failed !"
	exit 2
fi

cd $NQI_REP/platform/platform-ejb-test
mvn -Dmaven.test.skip=false test
STATUS=$?
if ! [ $STATUS -eq 0 ]; then
	echo "Platform test failed !"
	exit 2
fi

cd $NQI_REP/orchestra/orchestra-ejb-test
mvn clean install
STATUS=$?
if ! [ $STATUS -eq 0 ]; then
	echo "Orchestra clean install failed !"
	exit 2
fi

cd $NQI_REP/orchestra/orchestra-ejb-test
mvn -Dmaven.test.skip=false test 
STATUS=$?
if ! [ $STATUS -eq 0 ]; then
	echo "Orchestra test failed !"
	exit 2
fi
